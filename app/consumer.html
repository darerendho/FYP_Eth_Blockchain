<!doctype HTML>
<html>
<head>
    <title>Luxcure - Consumer</title>
  <script src="./javascripts/jquery-3.2.1.js"></script>
  <script src="./javascripts/utils.js"></script>
  <script src="./javascripts/tether.js"></script>
  <script src="./javascripts/bootstrap.min.js"></script>
  <script src="./javascripts/web3.js"></script>
  <link rel="stylesheet"  type="text/css" href="./stylesheets/bootstrap.min.css"/>
  <link rel="stylesheet"  type="text/css" href="./stylesheets/app.css"/>

  <script>
  if (typeof web3 !== 'undefined') {
web3 = new Web3(web3.currentProvider);
} else {
// set the provider you want from Web3.providers
web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

web3.eth.defaultAccount = web3.eth.accounts[0]; //Account from default account (manfacturer)
var contract_abi = web3.eth.contract([
  {
    "constant": false,
    "inputs": [
      {
        "name": "_model",
        "type": "bytes32"
      },
      {
        "name": "_status",
        "type": "bytes32"
      },
      {
        "name": "_date_manufactured",
        "type": "bytes32"
      }
    ],
    "name": "addNewGoods",
    "outputs": [
      {
        "name": "",
        "type": "bool"
      }
    ],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getManufacturer",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "model",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "status",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_stats",
        "type": "bytes32"
      }
    ],
    "name": "setStatus",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "log_count",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "contract_owner",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getStatus",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "owners_count",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_transfer_owner",
        "type": "address"
      }
    ],
    "name": "transaferOwnership",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_log",
        "type": "bytes32"
      }
    ],
    "name": "addRepairInfo",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "owners_list",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [],
    "name": "manufacturer",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getModel",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getCurrentOwner",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getNumberOfOwners",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "date_manufactured",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getPreviousOwner",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "repairs",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getDateManufactured",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  }
]);

var contract = contract_abi.at("0xcfc02973009f594d33e1079debf994fd90f5aa37"); // Deployed contract on the Blockchain\

function contractOwner(){
contract.getManufacturer(function(error,manufacturer){
  if(!error){
    if("0x2fb350c462e3d20bd4637d0e1d60079c4ae3229a" == manufacturer){
        document.getElementById('manufacturer').value = "Is the orignal manufacturer " + manufacturer;
    }
    else{
        document.getElementById('manufacturer').value = "Not manufacturer";
    }
  }
  else{
    console.log(error);
  }
});
}

function noOfOwners(){
contract.getNumberOfOwners(function(error,number_of_owners){
  if(!error){
    document.getElementById('owners').value = number_of_owners;
  }
  else{
    console.log(error);
  }
});
}

function transferOwnership(){
var transfer_address = document.getElementById("ethereum_trans_address").value;
contract.transaferOwnership.sendTransaction(transfer_address,{
    from:web3.eth.accounts[1],
    gas:4000000
});

contract.getCurrentOwner(function(error,current_owner){
  if(!error){
    console.log("The current owner is" +current_owner);
  }
  else{
    console.log(error);
  }
});
}

function changeStatus(){      //Change status of  the item

var status = web3.fromAscii(document.getElementById("status").value);

contract.setStatus.sendTransaction(status,{
  from:web3.eth.accounts[1],
  gas:4000000
});

contract.getStatus(function(error,status){
if(!error){
  console.log(web3.toAscii(status));
}
else{
  console.log(error);
}
});

}

  </script>
</head>


<body>
  <h1>Proof-of-Existence goods authentication</h1>
    <h1>Deploy a goods smart contract into an Ethereum Blockchain</h1>
    <h1> Manufacturer owner is 0x2fb350c462e3d20bd4637d0e1d60079c4ae3229a</h1>
  <div class="contentform">
    <div id="sendmessage"> Your message has been sent successfully. Thank you. </div>


    <div class="leftcontact">
    <div class="form-group">
      <p>Validate Manufacturer: <span>*</span></p>
       <span class="icon-case"><i class="fa fa-user"></i></span>
      <input type="text" name="manufacturer" id="manufacturer" data-rule="required" data-msg="Please enter a model number before submiting"/>
              <div class="validation"></div>
    </div>

    <div class="form-group">
      <button type="submit" onclick="contractOwner();" class="bouton-contact">Get original contract owner</button>
    </div>

    <div class="form-group">
    <p>Get number of owners: <span>*</span></p>
    <span class="icon-case"><i class="fa fa-location-arrow"></i></span>
      <input type="text" name="owners" id="owners" data-rule="required" data-msg="Please add the date that item is manufactured"/>
              <div class="validation"></div>
    </div>

    <div class="form-group">
        <button type="submit" onclick="noOfOwners();" class="bouton-contact">Get original contract owner</button>
    </div>

  </div>

  <div class="rightcontact">

    <div class="form-group">
    <p>Transfer Ownership: <span>*</span></p>
    <span class="icon-case"><i class="fa fa-building-o"></i></span>
      <input type="text" name="ethereum_trans_address" id="ethereum_trans_address" data-rule="required" data-msg="Vérifiez votre saisie sur les champs : Le champ 'Ville' doit être renseigné."/>
              <div class="validation"></div>
    </div>

    <div class="form-group">
      <button type="submit" onclick="transferOwnership();" class="bouton-contact">Transfer ownership</button>
    </div>

    <div class="form-group">
    <p>Flag stolen: <span>*</span></p>
    <span class="icon-case"><i class="fa fa-info"></i></span>
    <select id="status">
      <option value = "available">Available </option>
      <option value = "stolen">Stolen </option>
    </select>
    </div>

    <div class="form-group">
      <button type="submit" onclick="changeStatus();" class="bouton-contact">Change status</button>
    </div>
<!--
    <div class="form-group">
    <p>Message <span>*</span></p>
    <span class="icon-case"><i class="fa fa-comments-o"></i></span>
              <textarea name="message" rows="14" data-rule="required" data-msg="Vérifiez votre saisie sur les champs : Le champ 'Message' doit être renseigné."></textarea>
              <div class="validation"></div>
    </div>
-->
  </div>

  </div>

</body>
</html>
